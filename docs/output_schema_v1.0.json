{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LocalAgent Output Schema",
  "version": "1.0",
  "description": "Comprehensive output schema for SignalMesh Local Agent results",
  "type": "object",
  "required": ["task_id", "agent_id", "timestamp", "status", "context", "results", "metadata"],
  "properties": {
    "task_id": {
      "type": "string",
      "description": "Unique task identifier"
    },
    "agent_id": {
      "type": "string",
      "description": "Local Agent instance identifier"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Task completion timestamp (ISO 8601)"
    },
    "status": {
      "type": "string",
      "enum": ["success", "error"],
      "description": "Task execution status"
    },
    "message": {
      "type": "string",
      "description": "Human-readable status message"
    },
    "context": {
      "type": "object",
      "description": "Original request context",
      "required": ["requester", "request", "scope"],
      "properties": {
        "requester": {
          "type": "object",
          "description": "Information about who made the request",
          "properties": {
            "name": {"type": "string"},
            "email": {"type": "string", "format": "email"},
            "role": {"type": "string"},
            "timezone": {"type": "string"}
          }
        },
        "request": {
          "type": "object",
          "description": "Details about the request",
          "properties": {
            "original_question": {"type": "string"},
            "channel": {
              "type": "string",
              "enum": ["Email", "Slack", "Teams", "API"]
            },
            "thread_id": {"type": "string"},
            "urgency": {
              "type": "string",
              "enum": ["Low", "Normal", "High", "Critical"]
            },
            "requested_at": {"type": "string", "format": "date-time"},
            "requested_format": {
              "type": "string",
              "enum": ["summary", "detailed", "list"]
            }
          }
        },
        "scope": {
          "type": "object",
          "description": "Scope of the workspace scan",
          "properties": {
            "time_range": {"type": "string"},
            "start_date": {"type": ["string", "null"], "format": "date-time"},
            "end_date": {"type": ["string", "null"], "format": "date-time"},
            "workspace": {"type": "string"},
            "filter_type": {"type": "string"}
          }
        }
      }
    },
    "results": {
      "type": "object",
      "description": "Processing results",
      "required": ["summary", "statistics", "breakdown_by_type", "files"],
      "properties": {
        "summary": {
          "type": "string",
          "description": "Human-readable summary of findings"
        },
        "statistics": {
          "type": "object",
          "description": "Aggregate statistics",
          "properties": {
            "files_scanned": {"type": "integer"},
            "files_matched": {"type": "integer"},
            "files_processed": {"type": "integer"},
            "files_indexed": {"type": "integer"},
            "files_failed": {"type": "integer"},
            "total_size_bytes": {"type": "integer"},
            "total_size_mb": {"type": "number"}
          }
        },
        "breakdown_by_type": {
          "type": "object",
          "description": "Statistics broken down by file type",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "count": {"type": "integer"}
            }
          }
        },
        "files": {
          "type": "array",
          "description": "Detailed file analysis",
          "items": {
            "type": "object",
            "required": ["path", "name", "type", "analysis"],
            "properties": {
              "path": {"type": "string"},
              "name": {"type": "string"},
              "type": {"type": "string"},
              "size_bytes": {"type": "integer"},
              "modified": {"type": "string", "format": "date-time"},
              "created": {"type": ["string", "null"]},
              "author": {"type": "string"},
              "analysis": {
                "type": "object",
                "properties": {
                  "summary": {"type": "string"},
                  "details": {"type": "object"},
                  "content_preview": {"type": "string"},
                  "tags": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "rag_indexed": {"type": "boolean"},
                  "rag_id": {"type": ["string", "null"]}
                }
              }
            }
          }
        }
      }
    },
    "rag_status": {
      "type": "object",
      "description": "RAG system status",
      "properties": {
        "enabled": {"type": "boolean"},
        "collection_name": {"type": "string"},
        "total_documents": {"type": "integer"},
        "embedding_model": {"type": "string"},
        "embedding_dimension": {"type": "integer"},
        "vector_count": {"type": "integer"},
        "index_updated": {"type": "boolean"},
        "searchable": {"type": "boolean"}
      }
    },
    "insights": {
      "type": "object",
      "description": "Key insights for email drafting",
      "required": ["highlights", "activity_summary", "notable_changes", "recommendations"],
      "properties": {
        "highlights": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Key points to feature in response"
        },
        "activity_summary": {
          "type": "string",
          "description": "Overall activity description"
        },
        "notable_changes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {"type": "string"},
              "file": {"type": "string"},
              "description": {"type": "string"},
              "impact": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              }
            }
          }
        },
        "recommendations": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Action items for user"
        }
      }
    },
    "performance": {
      "type": "object",
      "description": "Performance metrics",
      "properties": {
        "processing_time_seconds": {"type": "number"},
        "scan_time_seconds": {"type": "number"},
        "parse_time_seconds": {"type": "number"},
        "index_time_seconds": {"type": "number"},
        "started_at": {"type": "string", "format": "date-time"},
        "completed_at": {"type": "string", "format": "date-time"}
      }
    },
    "errors": {
      "type": "array",
      "items": {"type": "string"},
      "description": "List of errors encountered"
    },
    "warnings": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "level": {"type": "string"},
          "message": {"type": "string"},
          "affected_files": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      }
    },
    "suggested_actions": {
      "type": "array",
      "description": "Follow-up actions to offer user",
      "items": {
        "type": "object",
        "required": ["action", "description", "example"],
        "properties": {
          "action": {"type": "string"},
          "description": {"type": "string"},
          "example": {"type": "string"}
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Metadata about the response",
      "required": ["agent_version", "schema_version", "reply_agent_compatible"],
      "properties": {
        "agent_version": {"type": "string"},
        "schema_version": {"type": "string"},
        "reply_agent_compatible": {"type": "boolean"},
        "requires_user_action": {"type": "boolean"},
        "is_final": {"type": "boolean"}
      }
    }
  }
}
